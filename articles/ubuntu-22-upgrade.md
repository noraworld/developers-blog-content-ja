---
title: "Ubuntu 22.04.1 LTS へのアップデートと注意点まとめ"
emoji: "🐠"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ubuntu", "linux", "raspberrypi", "ssh", "timedatectl"]
published: true
order: 152
layout: article
---

# はじめに
先日、Ubuntu 22.04.1 LTS (Jammy Jellyfish) にアップグレードしたので、そのときのことを軽くメモします。



# 環境
* Raspberry Pi 4



# アップグレード方法
以下のコマンドを実行するだけです。

```shell:Shell
do-release-upgrade
```

SSH 経由では推奨しないという警告が出るので、可能であれば SSH 経由ではない状態で実行することをおすすめします。



# アップグレードの注意点
アップグレード後に生じた問題についてざっと紹介します。

## SSH 接続ができなくなった
SSH のアップデートにより、RSA/SHA1 暗号方式の鍵がデフォルトで無効になったようです。

解決策については以下の記事にまとめました。

[SSH で RSA/SHA1 が使えなくなったので対策する](https://zenn.dev/noraworld/articles/ssh-rsa-sha1-disabled)

## 再起動時に日時がずれるようになった
原因は不明ですが、以下の方法で解決しました。

[Raspberry Pi を再起動するとシステム日時が狂う問題の解決法](https://zenn.dev/noraworld/articles/system-clock-synchronization)

## 使っているコマンドが勝手にアンインストールされてしまった
アップグレードの途中でもう必要なくなったパッケージをアンインストールしますか？ という確認メッセージが表示されます。

アンインストールするかしないかは選択できるのですが、必要ないと言っているので筆者はアンインストールすることを選択しました。

すると、今まで使っていたコマンドの一部が使えなくなってしまいました。

もちろん再インストールすれば良いのですが、結構たくさんのパッケージがアンインストールされて全部は追いきれないので、面倒を避けたい人はアンインストールするのは避けたほうが良いかもしれないです。

## 設定が勝手に変更されてしまう
アップグレードの途中で、いくつかのパッケージにおいて、デフォルトの設定ファイルが更新されたが、あなたもそのファイルを編集しているのでどうするかと聞かれます。

たいてい、以下のオプションから選ぶことになります。

* 自分自身で編集した内容を捨てて新しいデフォルトの設定を採用する
* 新しいデフォルトの設定を無視してそのままにする
* 両者をマージする

設定ファイルが更新されたということは、既存の設定では動かなくなる可能性があることもあります。新しい設定はちゃんとチェックしたかったので、両者をマージするオプションなどを採用したりしたのですが、やはりそうすると今まで動いていたのに動かなくなったりとか、意図した通りに動かなくなったりします。

筆者の場合、以下のパッケージで問題が発生しました。

* sudoers
    * cron で sudo を使うときにパスが通っていなくて実行できなくなった
* PulseAudio
    * 接続方式が変わってしまった

なお、パッケージによっては、現状の設定ファイルを別ファイル名でコピーしてバックアップを取り、強制的に新しい設定ファイルに更新してしまうものもあります。ここらへんも要チェックです。



# さいごに
わかってはいたことですが、やはり OS のアップグレードとなると今まで正常に動いていたものが動かなくなることが往々にしてあります。十分な時間があるときに腰を据えてじっくりとアップグレードするのが良さそうです。
