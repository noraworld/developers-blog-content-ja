---
title: "Vagrantのボックスは信頼できるソースを利用しよう"
emoji: "👋"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Vagrant", "VagrantBox"]
published: false
order: 19
---

# はじめに
先日、Vagrantのボックスが原因で問題が発生したため、ボックスを使用する際はあらかじめきちんと動作するかどうかを確かめてから使おうという個人的な注意書きです。

もちろん、一概にボックスが原因とは言えませんが、先日のケースではいくら設定を確認してもおかしな点は存在せず、別のボックスで試したら問題なく動作したので、ボックスを変更すると、もしかしたら原因不明の問題が解決するかもしれない、といった程度で捉えていただけると幸いです。

# 体験談
自分はボックスの入手先として[Vagrantbox.es](http://www.vagrantbox.es)を利用しています。OSの種類やバージョンが豊富なので重宝しています。

ところが、先日ダウンロードした Ubuntu Server 16.04 LTS のボックスでサーバを作成したところ、`$ vagrant ssh`によるログインはできますが、FTPクライアント(Cyberduck)によるログインができませんでした。

ユーザ名やパスワードは何回確認しても間違っておらず、ポートも閉じていませんし、ネットワークの設定も問題ありませんでした。パスワード認証も鍵認証も許可している状態で、両方とも試しましたがダメでした。新しいサーバを作り直しても結果は同じでした。

ネットの情報も一通り漁って気になる内容はすべて試しましたが一向に解決しないので、仕方なく別のボックスをダウンロードすることに。ところが今度はそもそも`$ vagrant up`ができない状況でした。GUIによるログインはできたのでおそらくVagrantの問題ではありますが、全く同じ現象についての解決方法をネットで見つけて試しても原因は解決しませんでした。

3度目の正直、3つめにダウンロードしたボックスではちゃんとVagrant側からも起動でき、FTPクライアントによるログインもできました。

# 使用の前に確認を
結局原因が不明、というのが腑に落ちないですが、もしこれがボックスによるものだとしたら、あるいはそうでなくともボックスを変更したことにより問題なく動作したことから、Vagrantのボックスは**問題なく動作するかを確かめてから使用する**ことが重要であることを強く思いました。

というのは、FTPクライアントでのログインができなかったボックスで作成したテストサーバに、すでに諸々の環境構築とセッティングを済ませた後にようやく問題に気づいたので、再び環境構築をし直すはめになりました。

もちろんこれは自分の責任ですし、そもそも[Vagrantbox.es](http://www.vagrantbox.es)は自己責任ということを承知した上で使用することになっているので、誰にも文句は言えない（むしろ感謝ですね:pray:）のですが、ちゃんと確認しておかないと後で痛い目を見ることになるよ、という自分に対する警告であります。

# 信頼できるボックス
これだけで終わってしまうとただの注意書きなので、自分が使用して問題なく動作したボックスのソースをここに載せておきます。ただし、これはあくまでぼくの環境で問題なかっただけなので、**全環境で問題なく動作することを保証するものではない**ことをご了承ください。

## CentOS
https://github.com/CommanderK5/packer-centos-template

:exclamation: [Vagrantbox.es](http://www.vagrantbox.es)のURLではないことに注意してください。Vagrantbox.esのURLはアップデートされることがあるので、このURLをVagrantbox.es内で検索してヒットした際のURLをご使用ください。また検索してもヒットしない場合は削除された可能性があります。ご了承ください。

## Ubuntu
https://atlas.hashicorp.com/gbarbieru/boxes/xenial

:exclamation: CentOSと同様に削除される可能性があります。ご了承ください。

## 環境
問題なく動作した環境は以下の通りです。繰り返しになりますが、この環境なら絶対に問題がないという保証はできませんのでご了承ください。

* macOS Sierra バージョン 10.12
* Vagrant 1.8.6
* VirtualBox バージョン 5.0.22 r108108

# さいごに
今後また他のOSのボックスを使用する機会があれば追加もしていく予定ですが、現状、CentOSとUbuntuがあれば問題ないので、別のバージョンや他の環境に関しては各自動作を確認してから使用してください。
