---
title: "コマンドラインでファイルやフォルダを暗号化する方法 (GPG 編)"
emoji: "🔑"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["gpg", "encryption", "cipher", "cryptography"]
published: true
---

# 忙しい人向け
```shell
# フォルダを圧縮
zip -r foo.zip foo

# 暗号化
gpg -e -r you@example.com -o /tmp/encrypted.zip.gpg foo.zip     # バイナリデータ
gpg -e -r you@example.com -o /tmp/encrypted.zip.gpg -a foo.zip  # アスキーデータ

# 復号
gpg -d -o /tmp/decrypted.zip encrypted.zip.gpg
```

| ロングオプション | ショートオプション | 説明 |
| --- | :---: | --- |
| `--encrypt` | `-e` | ファイルを暗号化します |
| `--recipient` | `-r` | 使用する秘密鍵を選択します |
| `--armor` | `-a` | バイナリではなくアスキーデータで出力します |
| `--output` | `-o` | 暗号化されたファイルの出力先を指定します |

| | バイナリデータ | アスキーデータ |
| :---: | --- | --- |
| **利点** | ファイルサイズが元のファイルと変わらない | テキストエディタで開ける、差分表示ができる |
| **欠点** | テキストエディタでは開けない、差分表示ができない | ファイルサイズが膨らむ |
| **拡張子** | `.gpg` | `.asc` |



# はじめに
前回は `openssl` コマンドを使ってファイルを暗号化する方法について紹介しました。

[コマンドラインでファイルを暗号化する方法 (OpenSSL 編)](https://zenn.dev/noraworld/articles/file-encryption)

しかし `openssl` コマンドによる暗号化だとファイルサイズが大きいファイルを正しく暗号化できないというデメリットがあります。

そこで今回は `gpg` コマンドを使ってファイル・フォルダを暗号化する方法について解説します。



# 前提
* `gpg` コマンドはインストール済みであること
* GPG キー (秘密鍵) は生成済みであること



# フォルダを圧縮
フォルダを直接的に暗号化することはできませんので、まずはフォルダを圧縮して ZIP ファイルにまとめます。フォルダではなくファイルを暗号化する場合はこの手順はスキップしてください。

カレントディレクトリにある `foo` というフォルダを圧縮するには以下のコマンドを実行します。ZIP ファイル `foo.zip` が生成されるはずです。

```shell
zip -r foo.zip foo
```

## 注意点
* フォルダを圧縮する際は `-r` を付け忘れないように注意しましょう。付け忘れると空 ZIP ファイルになります。
* 絶対パスを指定して圧縮すると展開したときにそのようなディレクトリ構造になってしまいます。また、圧縮前のフォルダ名は維持されます。

ここではコマンドラインで圧縮する方法を紹介しましたが、実際には OS のファイル管理アプリ（Mac なら Finder、Windows なら Explorer）のほうが間違いがなくて良いかもしれません。



# 暗号化
ファイルを暗号化するには以下のコマンドを実行します。暗号化されたファイル `foo.zip.gpg` が生成されるはずです。

```shell
gpg --encrypt --recipient you@example.com foo.zip
```

暗号化には `--encrypt` または `-e` オプションをつけます。`--recipient` または `-r` オプションを指定して該当する秘密鍵に使用したメールアドレス (署名 ID) を指定する必要があります。このオプションを省略した場合は実行時にインタラクティブ形式で求められます。

バイナリデータではなくアスキーデータ (テキストエディタで開ける形式) として保存したい場合は以下のように `--armor` または `-a` オプションを付与します。`foo.zip.asc` が生成されるはずです。

```shell
gpg --encrypt --recipient you@example.com --armor foo.zip
```

このファイルはテキストエディタで開くことができます。ただしファイルサイズによっては開くと重くなりますのでご注意ください。

デフォルトでは、暗号化されたファイルの出力先は暗号化前のファイルと同じディレクトリです。出力先を変更する場合は `--output` または `-o` オプションを指定します。**ディレクトリ名を指定するとそのディレクトリが暗号化ファイルになってしまうのでご注意ください。ファイル名まで含めて指定してください。**

```shell
gpg --encrypt --recipient you@example.com --output /tmp/encrypted.zip.gpg foo.zip
```

## よく使用するオプション一覧
上記で説明したよく使用するオプションの一覧を以下にまとめます。

| ロングオプション | ショートオプション | 説明 |
| --- | :---: | --- |
| `--encrypt` | `-e` | ファイルを暗号化します |
| `--recipient` | `-r` | 使用する秘密鍵を選択します |
| `--armor` | `-a` | バイナリではなくアスキーデータで出力します |
| `--output` | `-o` | 暗号化されたファイルの出力先を指定します |

## バイナリデータとアスキーデータの違い
両者とも復号すれば全く同じファイルが生成されるため、基本的にはどちらでも良いと思います。主な違いは以下のとおりです。

| | バイナリデータ | アスキーデータ |
| :---: | --- | --- |
| **利点** | ファイルサイズが元のファイルと変わらない | テキストエディタで開ける、差分表示ができる |
| **欠点** | テキストエディタでは開けない、差分表示ができない | ファイルサイズが膨らむ[^size] |
| **拡張子** | `.gpg` | `.asc` |

[^size]: 筆者の環境で 1.37 GB の ZIP ファイルをこの方法で暗号化したところ 1.85 GB になりました。



# 復号
暗号化したファイルを復号するには以下のコマンドを実行します。元のファイル `foo.zip` が生成されるはずです。

```shell
gpg foo.zip.gpg
```

復号には `--decrypt` または `-d` オプションを明示的に指定することもできますが、通常は勝手に推測してくれるので省略可能です。また、このオプションを指定した場合は `--output` または `-o` オプションを指定しないと、ファイルではなくターミナルに標準出力されてしまうためご注意ください。

```shell
gpg --decrypt --output /tmp/decrypted.zip foo.zip.gpg
```



# 参考
* [GPGコマンドで暗号化・復号](https://qiita.com/r_saiki/items/fb0bbbaa861e93f65ce9)
* [GnuPGでファイルを暗号化・復号する手順](https://laboradian.com/encrypt-with-gpg/)
